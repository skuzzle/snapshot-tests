plugins {
    id("snapshot-tests.base-conventions")
    id("com.github.kt3k.coveralls") version "2.12.0"
    id("jacoco-report-aggregation")
}


dependencies {
    allJavaModules()
            .collect({ it.path })
            .each({ jacocoAggregation(it) })
}

reporting {
    reports {
        jacocoRootReport(JacocoCoverageReport) {
            testType = TestSuiteType.UNIT_TEST

        }
    }
}


coveralls {
    sourceDirs = allJavaModules().sourceSets.main.allSource.srcDirs.flatten()
    jacocoReportPath = "${buildDir}/reports/jacoco/jacocoRootReport/jacocoRootReport.xml"
}
tasks.named("coveralls") {
    dependsOn("jacocoRootReport")
}