plugins {
    id 'snapshot-tests.base-conventions'
    id 'com.github.kt3k.coveralls' version '2.12.0'
    id 'jacoco-report-aggregation'
}

def allJavaModules() {
    project.rootProject.subprojects.findAll { it.pluginManager.hasPlugin('java-library') }
}

dependencies {
    jacocoAggregation project(':snapshot-tests-core')
    jacocoAggregation project(':snapshot-tests-junit5')
    jacocoAggregation project(':snapshot-tests-junit4')
    jacocoAggregation project(':snapshot-tests-html')
    jacocoAggregation project(':snapshot-tests-jaxb-jakarta')
    jacocoAggregation project(':snapshot-tests-jackson')
    jacocoAggregation project(':snapshot-tests-xmlunit')
    jacocoAggregation project(':snapshot-tests-normalize')
    jacocoAggregation project(':snapshot-tests-common')
}

reporting {
    reports {
        jacocoRootReport(JacocoCoverageReport) {
            testType = TestSuiteType.UNIT_TEST

        }
    }
}


coveralls {
    sourceDirs = allJavaModules().sourceSets.main.allSource.srcDirs.flatten()
    jacocoReportPath = "${buildDir}/reports/jacoco/jacocoRootReport/jacocoRootReport.xml"
}
tasks.named("coveralls") {
    dependsOn('jacocoRootReport')
}