import org.apache.tools.ant.filters.ReplaceTokens

plugins {
    id("org.asciidoctor.jvm.convert") version "3.3.2"
    id("snapshot-tests.java-conventions")
}

dependencies {
    testImplementation(projects.snapshotTestsJunit5)
    testImplementation(projects.snapshotTestsJackson)
    testImplementation(projects.snapshotTestsJaxb)
}

asciidoctor {
    sourceDir file("src/docs/asciidoc")
    attributes([
            "source-highlighter": "coderay",
            "toc"               : "left",
            "icons"             : "font",
            "setanchors"        : "true",
            "docinfo1"          : "true"
    ])
}
def repositoryDeployBasePath = "../docs/reference/"

tasks.register("deployDocsToRepositoryRoot") {
    dependsOn "deployDocsToRepositoryRootLatest", "deployDocsToRepositoryRootCurrent"
}

tasks.register("deployDocsToRepositoryRootLatest", Copy) {
    def repositoryDeployPathLatest = repositoryDeployBasePath + "latest"
    from(asciidoctor.outputs.files)
    into(repositoryDeployPathLatest)
}

tasks.register("deployDocsToRepositoryRootCurrent", Copy) {
    def repositoryDeployPathLatest = repositoryDeployBasePath + project.version
    from(asciidoctor.outputs.files)
    into(repositoryDeployPathLatest)
}