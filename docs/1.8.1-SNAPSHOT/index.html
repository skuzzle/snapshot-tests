<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<meta name="author" content="Simon Taddiken">
<title>Snapshot-Tests User Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Stylesheet for CodeRay to loosely match GitHub themes | MIT License */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid;opacity:.35;padding:0 .5em 0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff!important;background:navy!important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:navy}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:teal}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:teal}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:teal}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:teal}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.js"></script>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Snapshot-Tests User Guide</h1>
<div class="details">
<span id="author" class="author">Simon Taddiken</span><br>
<span id="revnumber">version 1.8.0</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#_versioning_compatibility_and_upgrading">1.1. Versioning, Compatibility and Upgrading</a></li>
</ul>
</li>
<li><a href="#_getting_started">2. Getting Started</a>
<ul class="sectlevel2">
<li><a href="#_artifacts">2.1. Artifacts</a></li>
<li><a href="#_choosing_the_right_modules">2.2. Choosing the Right Modules</a>
<ul class="sectlevel3">
<li><a href="#_use_with_junit5">Use With JUnit5</a></li>
<li><a href="#_use_with_junit5_legacy">Use With JUnit5 (Legacy)</a></li>
<li><a href="#_use_with_junit4">Use With JUnit4</a></li>
</ul>
</li>
<li><a href="#_quick_start_code_example">2.3. Quick Start Code Example</a></li>
<li><a href="#_general_snapshot_testing_workflow">2.4. General Snapshot Testing Workflow</a></li>
</ul>
</li>
<li><a href="#_reference">3. Reference</a>
<ul class="sectlevel2">
<li><a href="#_entrypoint">3.1. Entrypoint</a></li>
<li><a href="#_snapshot_serialization_and_comparison">3.2. Snapshot Serialization and Comparison</a>
<ul class="sectlevel3">
<li><a href="#_text_only_comparison">Text-only Comparison</a></li>
<li><a href="#_structural_comparison">Structural Comparison</a></li>
</ul>
</li>
<li><a href="#_updating_snapshot_files">3.3. Updating Snapshot Files</a>
<ul class="sectlevel3">
<li><a href="#_update_multiple_snapshots_within_the_same_test">Update Multiple Snapshots Within the Same Test</a></li>
<li><a href="#_update_the_snapshots_for_the_whole_project">Update the Snapshots for the Whole Project</a></li>
<li><a href="#_updating_the_snapshot_for_a_single_assertion">Updating the Snapshot for a Single Assertion</a></li>
</ul>
</li>
<li><a href="#_snapshot_files">3.4. Snapshot Files</a>
<ul class="sectlevel3">
<li><a href="#_changing_the_snapshot_location">Changing the Snapshot Location</a></li>
<li><a href="#_changing_the_snapshot_file_name">Changing the Snapshot File Name</a></li>
<li><a href="#_additional_context_files">Additional Context Files</a></li>
<li><a href="#_orphaned_snapshots">Orphaned Snapshots</a></li>
</ul>
</li>
<li><a href="#_multiple_assertions_in_the_same_test_case">3.5. Multiple Assertions in the Same Test Case</a></li>
<li><a href="#_disabling_snapshot_assertions">3.6. Disabling Snapshot Assertions</a></li>
<li><a href="#_parameterized_tests">3.7. Parameterized Tests</a></li>
<li><a href="#_soft_assertions">3.8. Soft Assertions</a></li>
</ul>
</li>
<li><a href="#_advanced_topics">4. Advanced topics</a>
<ul class="sectlevel2">
<li><a href="#_dealing_with_random_values_in_test_results">4.1. Dealing With Random Values in Test Results</a></li>
<li><a href="#_driving_snapshot_tests_from_files">4.2. Driving Snapshot Tests From Files</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This is the user manual for the snapshot-tests extension for JUnit5 and JUnit4.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The documentation is still in beta phase and might not be exhaustive. If you are missing any information feel free
to open a GitHub ticket and ask for help.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a><a class="link" href="#_introduction">1. Introduction</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This library allows to conveniently assert on the structure and contents of complex objects. It does so by storing a
serialized version of the object during the first test execution and during subsequent test executions, compare the
actual object against the stored snapshot.</p>
</div>
<div class="paragraph">
<p>Read more about <em>snapshot testing</em> in this accompanying <a href="https://simon.taddiken.net/the-case-for-snapshot-testing">blog post</a>.</p>
</div>
<div class="sect2">
<h3 id="_versioning_compatibility_and_upgrading"><a class="anchor" href="#_versioning_compatibility_and_upgrading"></a><a class="link" href="#_versioning_compatibility_and_upgrading">1.1. Versioning, Compatibility and Upgrading</a></h3>
<div class="paragraph">
<p>This project strongly aims to provide a stable public API with little surprises for clients when they upgrade to a new
version. We rely on the principles of <em>semantic versioning</em> and use
<a href="https://github.com/apiguardian-team/apiguardian">@API Guardian</a> to communicate the intention of all of public
classes/methods. Consequently you should not use any public types that are marked as <code>INTERNAL</code>.</p>
</div>
<div class="paragraph">
<p>The following principles apply:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Upgrading to a newer <em>patch</em> or <em>minor</em> version should never break client code or existing tests.</p>
</li>
<li>
<p>Upgrading to a newer <em>major</em> version can potentially break client code or tests.</p>
</li>
<li>
<p>All deprecations will be marked clearly in code and alternatives will be presented in the JavaDoc.</p>
</li>
<li>
<p>Deprecated code will be removed in accordance to the code&#8217;s previous API Guardian <code>status</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is possible that snapshot header information change even during a patch/minor update. This might cause your
snapshot files to occur as <em>modified</em> files in your local SCM copy after upgrading to a newer framework version. This
doesn&#8217;t pose a problem and you can safely update the files in your SCM.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started"><a class="anchor" href="#_getting_started"></a><a class="link" href="#_getting_started">2. Getting Started</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_artifacts"><a class="anchor" href="#_artifacts"></a><a class="link" href="#_artifacts">2.1. Artifacts</a></h3>
<div class="paragraph">
<p>The library comes with different modules that can be used and combined to fulfill different testing purposes. As such
it is not uncommon that you want to include multiple modules in your project&#8217;s dependencies. We provide a BOM artifact
for your convenience:</p>
</div>
<div class="listingblock">
<div class="title">Maven BOM artifact</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencyManagement&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>de.skuzzle.test<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>snapshot-tests-bom<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>1.8.0<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
        <span class="tag">&lt;scope&gt;</span>import<span class="tag">&lt;/scope&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencyManagement&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Gradle BOM include</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">testImplementation(platform(<span class="string"><span class="delimiter">&quot;</span><span class="content">de.skuzzle.test:snapshot-tests-bom:1.8.0</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Gradle Spring-Boot dependency management plugin</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencyManagement {
    imports {
        mavenBom <span class="string"><span class="delimiter">'</span><span class="content">de.skuzzle.test:snapshot-tests-bom:1.8.0</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following modules are managed in the previously mentioned BOM artifact. Follow the remaining documentation to
learn how to properly combine them to employ <em>snapshot testing</em> in your own project.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Available modules. Click the module&#8217;s name to view it on Maven Central.</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Module name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://search.maven.org/artifact/de.skuzzle.test/snapshot-tests-junit5/1.8.0/jar"><code>snapshot-tests-junit5</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JUnit5 extension.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://search.maven.org/artifact/de.skuzzle.test/snapshot-tests-junit4/1.8.0/jar"><code>snapshot-tests-junit4</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JUnit4 support via <code>@Rule</code> and <code>@ClassRule</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://search.maven.org/artifact/de.skuzzle.test/snapshot-tests-core/1.8.0/jar"><code>snapshot-tests-core</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core API and unstructured text comparison.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://search.maven.org/artifact/de.skuzzle.test/snapshot-tests-jackson/1.8.0/jar"><code>snapshot-tests-jackson</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON snapshot serialization using <code>jackson</code> and structured comparison using <code>jsonassert</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://search.maven.org/artifact/de.skuzzle.test/snapshot-tests-jaxb-jakarta/1.8.0/jar"><code>snapshot-tests-jaxb-jakarta</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XML snapshot serialization using <code>jaxb</code> with new jakarta dependencies and structured comparison using <code>xmlunit</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://search.maven.org/artifact/de.skuzzle.test/snapshot-tests-jaxb/1.8.0/jar"><code>snapshot-tests-jaxb</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XML snapshot serialization using <code>jaxb</code> and structured comparison using <code>xmlunit</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://search.maven.org/artifact/de.skuzzle.test/snapshot-tests-html/1.8.0/jar"><code>snapshot-tests-html</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTML snapshots using <code>jsoup</code> and structured comparison using <code>xmlunit</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://search.maven.org/artifact/de.skuzzle.test/snapshot-tests-directory-params/1.8.0/jar"><code>snapshot-tests-directory-params</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JUnit5 <code>ArgumentProvider</code> implementations that allow to iterate over files/directories.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_choosing_the_right_modules"><a class="anchor" href="#_choosing_the_right_modules"></a><a class="link" href="#_choosing_the_right_modules">2.2. Choosing the Right Modules</a></h3>
<div class="paragraph">
<p>In order to use snapshot-tests you have to answer two simple questions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Which test framework are you using?</p>
</li>
<li>
<p>Which format do you want to use for serializing objects into persistable snapshot files?</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_use_with_junit5"><a class="anchor" href="#_use_with_junit5"></a><a class="link" href="#_use_with_junit5">Use With JUnit5</a></h4>
<div class="paragraph">
<p>Historically JUnit5 is the preferred test framework and has always natively been supported. The preferred way of
configuring the build is to add a dependency to <code>snapshot-tests-junit5</code> and optionally add a dependency for your
preferred snapshot format (i.e. like <code>snapshot-tests-jackson</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_use_with_junit5_legacy"><a class="anchor" href="#_use_with_junit5_legacy"></a><a class="link" href="#_use_with_junit5_legacy">Use With JUnit5 (Legacy)</a></h4>
<div class="paragraph">
<p>The <code>snapshot-tests-junit5</code> module has been introduced with version <code>1.8.0</code>. Prior to that, you would either add a
direct dependency to <code>snapshot-tests-core</code> or just use a single dependency to you preferred snapshot format which
would pull in the <code>-core</code> module transitively. This setup still works but is discouraged. You will see a warning being
printed to <code>System.err</code> stating the required migration steps.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Starting from version <code>2.0.0</code> this scenario will no longer be supported.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_use_with_junit4"><a class="anchor" href="#_use_with_junit4"></a><a class="link" href="#_use_with_junit4">Use With JUnit4</a></h4>
<div class="paragraph">
<p>JUnit4 support was introduced with version <code>1.8.0</code>. Add a dependency to  <code>snapshot-tests-junit4</code> and optionally
add a dependency for your preferred snapshot format like <code>snapshot-tests-jackson</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In order to seamlessly support the JUnit5 legacy scenario described above, all snapshot format modules will still
 transitively pull in a JUnit5 dependency. Unfortunately this can only be fixed with the next major version.</p>
</div>
<div class="listingblock">
<div class="title">Exclude JUnit5 dependencies from snapshot format artifacts (maven)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>de.skuzzle.test<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>snapshot-tests-jackson<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>{revnumber}<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
    <span class="tag">&lt;exclusions&gt;</span>
        <span class="tag">&lt;exclusion&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.junit.jupiter<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>junit-jupiter-api<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;/exclusion&gt;</span>
    <span class="tag">&lt;/exclusions&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="title">Exclude JUnit5 dependencies from snapshot format artifacts (gradle, groovy syntax)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">testImplementation(<span class="string"><span class="delimiter">'</span><span class="content">de.skuzzle.test:snapshot-tests-jackson:{revnumber}</span><span class="delimiter">'</span></span>) {
    exclude <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">org.junit.jupiter</span><span class="delimiter">'</span></span>, <span class="key">module</span>: <span class="string"><span class="delimiter">'</span><span class="content">junit-jupiter-api</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_quick_start_code_example"><a class="anchor" href="#_quick_start_code_example"></a><a class="link" href="#_quick_start_code_example">2.3. Quick Start Code Example</a></h3>
<div class="paragraph">
<p>This is a very simple quick start example of how to use this framework, using the <code>-junit5</code> module and no particular
snapshot format. Instead, it simply uses the <code>toString()</code> representation of the test result to create a persistable
snapshot file.</p>
</div>
<div class="exampleblock">
<div class="title">Simple quick start example using maven and JUnit5</div>
<div class="content">
<div class="listingblock">
<div class="title">Add Maven dependency</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>de.skuzzle.test<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>snapshot-tests-junit5<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>{revnumber}<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Write a simple snapshot test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.junit.jupiter.api.Test</span>;

<span class="keyword">import</span> <span class="include">de.skuzzle.test.snapshots.Snapshot</span>;
<span class="keyword">import</span> <span class="include">de.skuzzle.test.snapshots.junit5.EnableSnapshotTests</span>;

<span class="annotation">@EnableSnapshotTests</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">QuickstartTest</span> {

    <span class="annotation">@Test</span>
    <span class="type">void</span> testCreateSnapshotAsText(Snapshot snapshot) <span class="directive">throws</span> <span class="exception">Exception</span> { <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="directive">final</span> Person actual = Person.determinePerson();
        snapshot.assertThat(actual)
                .asText() <i class="conum" data-value="3"></i><b>(3)</b>
                .matchesSnapshotText(); <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enable the <em>JUnit5</em>  extension for your test class.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare a parameter of type <code>Snapshot</code>. It will be injected by the framework.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Choose a serialization format. Here we use the <code>actual</code> object&#8217;s <code>toString()</code> representation as snapshot format.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Perform the assertion by comparing the actual object with the persisted snapshot.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_general_snapshot_testing_workflow"><a class="anchor" href="#_general_snapshot_testing_workflow"></a><a class="link" href="#_general_snapshot_testing_workflow">2.4. General Snapshot Testing Workflow</a></h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Implement test cases and add one ore more snapshot assertions as shown above.</p>
</li>
<li>
<p>When you execute these tests the <em>first</em> time, serialized snapshots of your test results will be persisted and <em>the tests will fail</em>.</p>
</li>
<li>
<p>Execute the same tests again. Now, the framework will compare the test results against the persisted snapshots. If your code under test produces deterministic results, tests should now be green.</p>
</li>
<li>
<p>Check in the persisted snapshots into your SCM.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The framework will fail all snapshot assertions when they are initially executed and there is no previous
snapshot file to compare the current result against. This guards against accidently checking in broken or flaky tests
into your SCM.</p>
</div>
<div class="listingblock">
<div class="title">Assertion error after snapshots have been created initially</div>
<div class="content">
<pre class="CodeRay highlight"><code>java.lang.AssertionError: Snapshots have been created the first time.
Run the test again and you should see it succeed.</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you find that your tests are flaky or continue to fail even after the initial test execution, take a look at
the section about dealing with <a href="#_dealing_with_random_values_in_test_results">random values</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reference"><a class="anchor" href="#_reference"></a><a class="link" href="#_reference">3. Reference</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_entrypoint"><a class="anchor" href="#_entrypoint"></a><a class="link" href="#_entrypoint">3.1. Entrypoint</a></h3>
<div class="paragraph">
<p>As shown in the <a href="#_getting_started">Getting Started</a> section, you need to enable snapshot tests capabilities for your
test class by annotating it with <code>@EnabledSnapshotTests</code>. This registers a <em>JUnit5</em> <code>ArgumentResolver</code> which
takes care of injecting a <code>Snapshot</code> instance into your test methods. The <code>Snapshot</code> interface is the entrypoint
for the <em>assertion DSL</em>.</p>
</div>
<div class="paragraph">
<p>If you are using <code>JUnit4</code>, you need to declare the SnapshotRule like this:</p>
</div>
<div class="listingblock">
<div class="title">Enabling snapshot test capabilities in a JUnit4 test</div>
<div class="content">
<pre class="CodeRay highlight"><code>@Rule
@ClassRule
public static final SnapshotRule snapshot = SnapshotRule.enableSnapshotTests();</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You need to declare the rule as both <code>@Rule</code> and <code>@ClassRule</code> as there is no other possibility for the
snapshot-tests framework to obtain all the relevant test execution information from the JUnit4 engine.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Besides the different way of enabling the snapshot testing capabilities there are no further differences between
usage in JUnit4 and JUnit5. The <code>Snapshot</code> class is the main entrypoint for writing snapshot assertions.</p>
</div>
</div>
<div class="sect2">
<h3 id="_snapshot_serialization_and_comparison"><a class="anchor" href="#_snapshot_serialization_and_comparison"></a><a class="link" href="#_snapshot_serialization_and_comparison">3.2. Snapshot Serialization and Comparison</a></h3>
<div class="paragraph">
<p>The framework needs to create a <code>String</code> representation of the test results in order to store it in a <em>snapshot file</em>.
Creating such a String representation is referred to as <em>serialization</em> and this aspect is handled by implementations
of the <code>SnapshotSerializer</code> interface.</p>
</div>
<div class="paragraph">
<p>To compare persisted snapshot data against actual test results, the framework serializes the actual test result as well
and passes both Strings to an instance of <code>StructuralAssertions</code>.</p>
</div>
<div class="paragraph">
<p>Though serialization and comparison are handled by different components the aspects are still related. As
<code>StructuralAssertions</code> solely work on the String representation it is important that the implementation understands the
Strings that have been produced by the <code>SnapshotSerializer</code> (i.e. you should not mix a serializer that produces XML with
an <code>StructualAssertions</code> instance that compares JSON).</p>
</div>
<div class="paragraph">
<p>The Snapshot DSL allows you to configure these aspects separately but also provides a convenient API for configuring
the Serializer and Assertions at once via the <code>StructuredData</code> class.</p>
</div>
<div class="paragraph">
<p>The DSL distinguishes between <em>just text</em> and <em>structured text</em> snapshots. This distinction influences the way in which
new test results can be compared to persisted snapshots:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a snapshot uses a <em>structured format</em> such as <code>XML</code> or <code>JSON</code> the framework can make use of that structure during
comparison to offer better error messages or to allow customization of the comparison details.</p>
</li>
<li>
<p>If a snapshot consists of <em>just text</em> the framework can only make a text comparison.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_text_only_comparison"><a class="anchor" href="#_text_only_comparison"></a><a class="link" href="#_text_only_comparison">Text-only Comparison</a></h4>
<div class="paragraph">
<p>In order to present a meaningful <em>assertion failed</em> message the framework will always create a unified diff of the
persisted snapshot and the serialized <code>actual</code> result.</p>
</div>
<div class="exampleblock">
<div class="title">Serialize without structured format and apply text-only comparison.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">snapshot.assertThat(actual)
        .asText()
        .matchesSnapshotText(); <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>.matchesSnapshotText()</code> is <em>the only</em> available option when you choose no structured format using <code>asText()</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>If the assertion fails because a difference has been found, the framework will provide a rich failure report along
with the assertion error&#8217;s stack trace.</p>
</div>
<div class="listingblock">
<div class="title">Example text comparison failure.</div>
<div class="content">
<pre class="CodeRay highlight"><code>org.opentest4j.AssertionFailedError: Stored snapshot doesn't match actual result.

Snapshot location:
    src\test\resources\de\skuzzle\test\snapshots\snippets\ComparisonTests_snapshots\testCreateSnapshotAsText_0.snapshot

Full unified diff of actual result and stored snapshot:
  7    - Name: &lt;&lt;Simon&gt;&gt;
     7 + Name: &lt;&lt;Peter&gt;&gt;
  8    - Surname: &lt;&lt;Taddiken&gt;&gt;
     8 + Surname: &lt;&lt;Pan&gt;&gt;
  9  9   Birthdate: 1777-01-12
 10 10   Address: Street: Gibtsnicht-Strae
 11 11   Number: 1337
 12 12   Zip: 4711
 13 13   City: Bielefeld
[...]

    at de.skuzzle.test.snapshots.snippets.ComparisonTests.testCreateSnapshotAsText(ComparisonTests.java:29)
    [...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Most IDEs will additionally allow you to display the differences in a dedicated diff viewer. For example, if you double
click the assertion failure in eclipse&#8217;s <em>Failure Trace</em> view you will be presented with the following view.</p>
</div>
<div id="img-eclipse_diff" class="imageblock text-center">
<div class="content">
<img src="./images/eclipse_diff.jpg" alt="eclipse diff">
</div>
<div class="title">Figure 1. The same assertion error as displayed in eclipse&#8217;s diff viewer.</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Displaying multiple differences <em>at once</em> is one key strength of snapshot testing. It gives you the value of
<code>n</code> assertions for only writing a <strong>single</strong> one.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_structural_comparison"><a class="anchor" href="#_structural_comparison"></a><a class="link" href="#_structural_comparison">Structural Comparison</a></h4>
<div class="paragraph">
<p>When using a structured serialization format you can make use of advanced comparison features offered by the respective
format.</p>
</div>
<div class="exampleblock">
<div class="title">Serialize to JSON and apply structural comparison.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">snapshot.assertThat(actual)
        .as(JsonSnapshot.json()) <i class="conum" data-value="1"></i><b>(1)</b>
        .matchesSnapshotStructure(); <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Choose to serialize test results as JSON (Requires the <code>snapshot-tests-jackson</code> module).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Choose <code>.matchesSnapshotStructure()</code> to trigger structural comparison.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>When comparison fails, the framework enhances the failure message with additional information from the structural
comparison.</p>
</div>
<div class="listingblock">
<div class="title">Example structural comparison failure for JSON snapshots.</div>
<div class="content">
<pre class="CodeRay highlight"><code>org.opentest4j.AssertionFailedError: name
Expected: Simon
     got: Peter
 ; surname
Expected: Taddiken
     got: Pan


Snapshot location:
    src\test\resources\de\skuzzle\test\snapshots\snippets\ComparisonTests_snapshots\testCreateSnapshotAsJson_0.snapshot

Full unified diff of actual result and stored snapshot:
  7  7   {
  8    -   &quot;name&quot; : ~~~~&quot;Simon&quot;~~~~,
     8 +   &quot;name&quot; : ~~~~&quot;Peter&quot;~~~~,
  9    -   &quot;surname&quot; : ~~~~&quot;Taddiken&quot;~~~~,
     9 +   &quot;surname&quot; : ~~~~&quot;Pan&quot;~~~~,
 10 10     &quot;birthdate&quot; : &quot;1777-01-12&quot;,
 11 11     &quot;address&quot; : {
 12 12       &quot;street&quot; : &quot;Gibtsnicht-Strae&quot;,
 13 13       &quot;number&quot; : &quot;1337&quot;,
 14 14       &quot;zipCode&quot; : &quot;4711&quot;,
[...]

    at de.skuzzle.test.snapshots.snippets.ComparisonTests.testCreateSnapshotAsJson(ComparisonTests.java:41)
    [...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Likewise for <code>XML</code> serialization:</p>
</div>
<div class="exampleblock">
<div class="title">Serialize to XML and apply structural comparison.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">snapshot.assertThat(actual)
        .as(XmlSnapshot.xml())
        .matchesSnapshotStructure();</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Example structural comparison failure for XML snapshots.</div>
<div class="content">
<pre class="CodeRay highlight"><code>org.opentest4j.AssertionFailedError:

Expecting:
 &lt;control instance&gt; and &lt;test instance&gt; to be identical
Expected text value 'Simon' but was 'Peter' - comparing &lt;name ...&gt;Simon&lt;/name&gt; at /person[1]/name[1]/text()[1] to &lt;name ...&gt;Peter&lt;/name&gt; at /person[1]/name[1]/text()[1]
Expected :&lt;&lt;name&gt;Simon&lt;/name&gt;&gt;
Actual   :&lt;&lt;name&gt;Peter&lt;/name&gt;&gt;


Snapshot location:
    src\test\resources\de\skuzzle\test\snapshots\snippets\ComparisonTests_snapshots\testCreateSnapshotAsXml_0.snapshot

Full unified diff of actual result and stored snapshot:
[...]
 12 12           &lt;number&gt;1337&lt;/number&gt;
 13 13           &lt;street&gt;Gibtsnicht-Strae&lt;/street&gt;
 14 14           &lt;zipCode&gt;4711&lt;/zipCode&gt;
 15 15       &lt;/address&gt;
 16 16       &lt;birthdate/&gt;
 17    -     ~~~~&lt;name&gt;Simon&lt;~~~~/name&gt;
    17 +     ~~~~&lt;name&gt;Peter&lt;~~~~/name&gt;
 18    -     ~~~~&lt;surname&gt;Taddiken&lt;~~~~/surname&gt;
    18 +     ~~~~&lt;surname&gt;Pan&lt;~~~~/surname&gt;
 19 19   &lt;/person&gt;
    at de.skuzzle.test.snapshots.snippets.ComparisonTests.testCreateSnapshotAsXml(ComparisonTests.java:53)
    [...]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_updating_snapshot_files"><a class="anchor" href="#_updating_snapshot_files"></a><a class="link" href="#_updating_snapshot_files">3.3. Updating Snapshot Files</a></h3>
<div class="paragraph">
<p>One aspect that makes <em>snapshot testing</em> so powerful is that you can generate the <em>expected output</em> from your
<em>code under test</em> itself. This removes the necessity to manually update test cases when the behavior of your
code under test changes. The framework comes with a convenient approach for updating multiple snapshot files at once.
You should stick to the following workflow:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make the desired changes to your code under test. If you run the snapshot tests now they should fail.</p>
</li>
<li>
<p>Advise the framework to update the snapshot files with the latest actual results.</p>
</li>
<li>
<p>Inspect the changes within your snapshot files to see whether they reflect your desired outcome (your
SCM should mark the changed files as <em>modified</em> and should thus be able display a neat diff to the previous version).</p>
</li>
<li>
<p>Remove the advice to update snapshots.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Whenever the framework overrides a snapshot with the new actual test result, the respective assertion will
fail. As already stated in the <a href="#_general_snapshot_testing_workflow">Getting Started</a> section, this is to prevent you
from accidently checking in broken tests into your SCM.</p>
</div>
<div class="listingblock">
<div class="title">Assertion error after forcefully updating snapshots</div>
<div class="content">
<pre class="CodeRay highlight"><code>java.lang.AssertionError: Snapshots have been updated forcefully.
Remove 'updateSnapshots = true' attribute, @ForceUpdateSnapshots annotation, -DforceUpdateSnapshots JVM flag and calls to 'justUpdateSnapshot()' and run the tests again.</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_update_multiple_snapshots_within_the_same_test"><a class="anchor" href="#_update_multiple_snapshots_within_the_same_test"></a><a class="link" href="#_update_multiple_snapshots_within_the_same_test">Update Multiple Snapshots Within the Same Test</a></h4>
<div class="paragraph">
<p>You can place the <code>@ForceUpdateSnapshots</code> annotation on either your test method or your whole test class to advise
the framework to update the snapshots of all affected assertions.</p>
</div>
<div class="exampleblock">
<div class="title">Update the snapshots for all assertions in the same test method</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="annotation">@ForceUpdateSnapshots</span>
<span class="type">void</span> testUpdateSnapshotWithAnnotation(Snapshot snapshot) {
    <span class="directive">final</span> Person person = Person.determinePerson();
    snapshot.assertThat(person)
            .asText()
            .matchesSnapshotText();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Update the snapshots for all assertions in the same test class</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EnableSnapshotTests</span>
<span class="annotation">@ForceUpdateSnapshots</span>
<span class="type">class</span> <span class="class">PersonTest</span> {

    <span class="annotation">@Test</span>
    <span class="type">void</span> testUpdateSnapshotWithAnnotation(Snapshot snapshot) {
        <span class="directive">final</span> Person person = Person.determinePerson();
        snapshot.assertThat(person)
                .asText()
                .matchesSnapshotText();
    }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You might find it irritating that the <code>@ForceUpdateSnapshots</code> annotation is marked as deprecated. This is just
a hack to make your IDE highlight its usages as it is intended to be only used temporarily.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_update_the_snapshots_for_the_whole_project"><a class="anchor" href="#_update_the_snapshots_for_the_whole_project"></a><a class="link" href="#_update_the_snapshots_for_the_whole_project">Update the Snapshots for the Whole Project</a></h4>
<div class="paragraph">
<p>Snapshots can also be updated globally by passing the <code>-DforceUpdateSnapshots</code> parameter to the JVM. This will
update the snapshots of all tests executed within the JVM.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using <code>maven</code> you can pass the option to the <code>surefire-plugin</code> on the command line using this little trick:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mvn clean verify -DargLine=-DforceUpdateSnapshots</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Handling of the parameter is case-insensitive.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_updating_the_snapshot_for_a_single_assertion"><a class="anchor" href="#_updating_the_snapshot_for_a_single_assertion"></a><a class="link" href="#_updating_the_snapshot_for_a_single_assertion">Updating the Snapshot for a Single Assertion</a></h4>
<div class="paragraph">
<p>You can replace the call to <code>.matchesSnapshotText()</code> or <code>.matchesSnapshotStructure()</code> of your assertion with
<code>.justUpdateSnapshot()</code>. When executing the test, the framework will simply override the existing snapshot for this
assertion with the passed in <code>actual</code> result.</p>
</div>
<div class="listingblock">
<div class="title">Change the assertion to update the snapshot file</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="type">void</span> testUpdateSnapshot(Snapshot snapshot) {
    <span class="directive">final</span> Person person = Person.determinePerson();
    snapshot.assertThat(person)
            .asText()
            .justUpdateSnapshot(); <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Temporarily remove the actual assertion and replace it with <code>justUpdateSnapshot()</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_snapshot_files"><a class="anchor" href="#_snapshot_files"></a><a class="link" href="#_snapshot_files">3.4. Snapshot Files</a></h3>
<div class="paragraph">
<p>By convention, snapshots of your test results are persisted as <code>.snapshot</code> files below <code>src/test/resources</code>. The
framework will create sub directories according to your test class&#8217;s package and name. The snapshot file&#8217;s name will
be derived from the respective test&#8217;s method name.</p>
</div>
<div class="paragraph">
<p>The snapshot file does not only include the serialized test result but also a small header section containing some
meta information. These information are used by the framework to map the snapshot file to the test method and
assertion from which it was created.</p>
</div>
<div class="sect3">
<h4 id="_changing_the_snapshot_location"><a class="anchor" href="#_changing_the_snapshot_location"></a><a class="link" href="#_changing_the_snapshot_location">Changing the Snapshot Location</a></h4>
<div class="paragraph">
<p>If you don not want to use the automatic way of determining the snapshot directory there are multiple options to manually
specify the directory to which snapshot files will be written.</p>
</div>
<div class="listingblock">
<div class="title">Change the directory of a snapshot via the DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="type">void</span> testChangeDirectoryViaDSL(Snapshot snapshot) {
    <span class="directive">final</span> Person person = Person.determinePerson();
    snapshot
            .in(Path.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">src</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">resources</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">snapshots</span><span class="delimiter">&quot;</span></span>)) <i class="conum" data-value="1"></i><b>(1)</b>
            .assertThat(person)
            .asText()
            .matchesSnapshotText();
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Before calling <code>assertThat(&#8230;&#8203;)</code> you can use <code>in(&#8230;&#8203;)</code> to specify the snapshot directory for this assertion.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The path you provide here will not be resolved against the <code>src/test/resources</code> directory.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Another way is to use the <code>@SnapshotDirectory</code> annotation to provide a static snapshot directory.</p>
</div>
<div class="listingblock">
<div class="title">Change the directory of a snapshot via annotation.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="annotation">@SnapshotDirectory</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">snapshots</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="type">void</span> testChangeDirectoryViaAnnotation(Snapshot snapshot) {
    <span class="directive">final</span> Person person = Person.determinePerson();
    snapshot
            .assertThat(person)
            .asText()
            .matchesSnapshotText();
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Statically provide a snapshot directory relative to <code>src/test/resources</code> via <code>@SnapshotDirectory.</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, you can provide an implementation of <code>SnapshotDirectoryStrategy</code> like this:</p>
</div>
<div class="listingblock">
<div class="title">Change the directory of a snapshot via strategy.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="annotation">@SnapshotDirectory</span>(determinedBy = ResolveSnapshotDirectory.class) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="type">void</span> testChangeDirectoryViaStrategy(Snapshot snapshot) {
    <span class="directive">final</span> Person person = Person.determinePerson();
    snapshot
            .assertThat(person)
            .asText()
            .matchesSnapshotText();
}

<span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">ResolveSnapshotDirectory</span> <span class="directive">implements</span> SnapshotDirectoryStrategy { <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="annotation">@Override</span>
    <span class="directive">public</span> Path determineSnapshotDirectory(<span class="predefined-type">Class</span>&lt;?&gt; testClass, SnapshotDirectory directory)
            <span class="directive">throws</span> SnapshotException {
        <span class="keyword">return</span> Path.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">src</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">resources</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">snapshots</span><span class="delimiter">&quot;</span></span>);
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Point the framework to an implementation of <code>SnapshotDirectoryStrategy</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Implement the strategy.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All three examples given will resolve to the same directory <code>src/test/resources/snapshots</code>.
Instead of placing the <code>@SnapshotDirectory</code> annotation on each test method, you can also put it globally on the test
class itself.</p>
</div>
</div>
<div class="sect3">
<h4 id="_changing_the_snapshot_file_name"><a class="anchor" href="#_changing_the_snapshot_file_name"></a><a class="link" href="#_changing_the_snapshot_file_name">Changing the Snapshot File Name</a></h4>
<div class="paragraph">
<p>In order to store persisted snapshots, the framework will determine a proper location and file name from the name of
the respective test class and test method. By default, the snapshot will be named after the test method&#8217;s name. For
each snapshot assertion within the same method, a consecutive number will be appended to the name (see also the section
about <a href="#_multiple_assertions_in_the_same_test_case">Multiple Assertions in the Same Test Case</a>).</p>
</div>
<div class="paragraph">
<p>The DSL offers a method to provide a custom name. Either by directly passing in a static string or by providing an
implementation of <code>SnapshotNaming</code>:</p>
</div>
<div class="listingblock">
<div class="title">Provide a static snapshot file name as string.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="type">void</span> testChangeSnapshotNameStatic(Snapshot snapshot) {
    <span class="directive">final</span> Person person = Person.determinePerson();
    snapshot
            .named(<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
            .assertThat(person)
            .asText()
            .matchesSnapshotText();
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Provide a static name. The resulting snapshot file will be named <code>person.snapshot</code>.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Provide a static snapshot file name via <code>NamingStrategy</code>.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="type">void</span> testChangeSnapshotNameStaticStrategy(Snapshot snapshot) {
    <span class="directive">final</span> Person person = Person.determinePerson();
    snapshot
            .namedAccordingTo(SnapshotNaming.constant(<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>)) <i class="conum" data-value="1"></i><b>(1)</b>
            .assertThat(person)
            .asText()
            .matchesSnapshotText();
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Provide an instance of <code>SnapshotNaming</code>. In this case the strategy will again just return the static string</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you use parameterized tests, the automatic snapshot naming will determine the same snapshot file name for
every parameter, thus overridding the snapshot file for each parameterization. See
<a href="#_parameterized_tests">Parameterized Tests</a> section for details.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_additional_context_files"><a class="anchor" href="#_additional_context_files"></a><a class="link" href="#_additional_context_files">Additional Context Files</a></h4>
<div class="paragraph">
<p>The framework offers the possibility to not only generate the <code>.snapshot</code> file which will be used in the assertions but
it can also generate additional contextual files.</p>
</div>
<div class="paragraph">
<p>You can advise the framework to <em>always</em> persist the actual results of the most recent test execution. In that case the
framework will generate a sibling file with <code>.snapshot_actual</code> extension next to the regular <code>.snapshot</code> file. This
file contains the serialized actual result of the most recent test execution as well as the same header information as
the regular <code>.snapshot</code> file. This allows you to quickly replace the snapshot with the most recent test results without
having to execute the test suite again. You can enable this feature via <code>@SnapshotTestOptions</code> annotation:</p>
</div>
<div class="listingblock">
<div class="title">Advise the framework to always persist latest test results.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="annotation">@SnapshotTestOptions</span>(alwaysPersistActualResult = <span class="predefined-constant">true</span>)
<span class="type">void</span> testAlwaysPersistActual(Snapshot snapshot) <span class="directive">throws</span> <span class="exception">Exception</span> {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the same way you can advise the framework to also persist the most recent test results as a raw file which does not
contain the snapshot header information. This wil lresult in another sibling file with <code>.snapshot_raw</code> extension.</p>
</div>
<div class="listingblock">
<div class="title">Advise the framework to always persist latest test results without header information.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="annotation">@SnapshotTestOptions</span>(alwaysPersistRawResult = <span class="predefined-constant">true</span>)
<span class="type">void</span> testAlwaysPersistActualRaw(Snapshot snapshot) <span class="directive">throws</span> <span class="exception">Exception</span> {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The annotation can as well be placed on the test class to change these options globally.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You should add the extensions of these context files to your <code>.gitignore</code> file. Unlike the main snapshot files,
the context files are not meant to be checked into the SCM.</p>
</div>
<div class="listingblock">
<div class="title">Add context files to .gitignore</div>
<div class="content">
<pre class="CodeRay highlight"><code>*.snapshot_actual
*.snapshot_raw</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_orphaned_snapshots"><a class="anchor" href="#_orphaned_snapshots"></a><a class="link" href="#_orphaned_snapshots">Orphaned Snapshots</a></h4>
<div class="paragraph">
<p>Snapshot files can become <em>orphans</em> if you rename or delete test methods/classes. It is desirable to remove orphaned
snapshots as they will otherwise just add clutter to your repository. The framework comes with a sophisticated
approach for detecting and removing such orphaned files.</p>
</div>
<div class="paragraph">
<p>By default, the framework will just log a warning like this to the console about detected orphan files:</p>
</div>
<div class="listingblock">
<div class="title">Warning about detected orphan file</div>
<div class="content">
<pre class="CodeRay highlight"><code>WARNING: Found orphaned snapshot file. Run with @DeleteOrphanedSnapshots annotation to remove: testThatHasBeenDeleted_0.snapshot in src/test/resources/de/skuzzle/test/snapshots/impl/OrphanedSnapshotDetectionTest$TestCase_snapshots</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are a number of situations in which a snapshot can become an orphan:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The test method containing the snapshot assertion has been removed/renamed.</p>
</li>
<li>
<p>The test class containing the test with the snapshot assertion has been removed/renamed.</p>
</li>
<li>
<p>The test is no longer a snapshot test.</p>
</li>
<li>
<p>Another snapshot assertion has been added/removed to/from the same test method.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Info about orphan detection</div>
<div class="paragraph">
<p>Orphan detection is not a straight forward task and quite a lot complexity within the implementation of this library
comes from solving this task.</p>
</div>
<div class="paragraph">
<p>For example, just by examining a snapshot file, the framework can&#8217;t reliably determine whether the test still contains
the <em>snapshot assertion statement</em> that created the file in the first place.</p>
</div>
<div class="paragraph">
<p>On the other hand there are some criteria that <em>can</em> be examined <em>statically</em>. As the snapshot file&#8217;s header
information contain the full qualified name of the test class and the name of the test method, it is quite easy to
determine whether those still exists or not.</p>
</div>
<div class="paragraph">
<p>Consequently, orphan detection implementation is separated into two phases:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>During <em>dynamic orphan detection</em>, the framework collects the actual snapshot results of all executed tests. Then it checks all existing snapshot files for whether there exists a matching result.</p>
</li>
<li>
<p>During <em>static orphan detection</em>, the framework examines the header information of all snapshot files to determine whether their originating class/test still exist.</p>
</li>
</ol>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
This approach has the drawback that orphans can be reported falsely if you only run a subset of your test suite.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>You can advise the framework to automatically delete the detected orphaned files during a test run. This works similar
to updating snapshot files by either adding an annotation or by passing a flag to the JVM.</p>
</div>
<div class="exampleblock">
<div class="title">Delete detected orphans during test execution</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EnableSnapshotTests</span>
<span class="annotation">@DeleteOrphanedSnapshots</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">DeleteOrphansTest</span> {

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Temporarily add the <code>@DeleteOrphanedSnapshots</code> annotations during test execution.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You might find it irritating that the <code>@DeleteOrphanedSnapshots</code> annotation is marked as deprecated. This is just
a hack to make your IDE highlight its usages as it is intended to be only used temporarily.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also pass the flag <code>-DdeleteOrphanedSnapshots</code> to the JVM.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using <code>maven</code> you can pass the option to the <code>surefire-plugin</code> on the command line using this little trick:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mvn clean verify -DargLine=-DdeleteOrphanedSnapshots</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Handling of the parameter is case insensitive.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_multiple_assertions_in_the_same_test_case"><a class="anchor" href="#_multiple_assertions_in_the_same_test_case"></a><a class="link" href="#_multiple_assertions_in_the_same_test_case">3.5. Multiple Assertions in the Same Test Case</a></h3>
<div class="paragraph">
<p>You can have multiple assertions in the same test case. The framework will assign each snapshot file a
consecutive number.</p>
</div>
<div class="listingblock">
<div class="title">Use multiple assertions in the same Test Case</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="type">void</span> testWithMultipleAssertions(Snapshot snapshot) <span class="directive">throws</span> <span class="exception">Exception</span> {
    <span class="directive">final</span> Person person1 = person();
    <span class="directive">final</span> Person person2 = person();
    snapshot.assertThat(person1).asText().matchesSnapshotText();
    snapshot.assertThat(person2).asText().matchesSnapshotText();
}</code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
As the snapshot files are numbered in order of their assertion&#8217;s execution, you can not easily reorder the
assertions within the test case. If you do, the framework would not be able to map the assertion to the correct
snapshot file.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
As is the case with <em>normal</em> tests you should avoid having multiple/many/too many assertions in a single test case.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_disabling_snapshot_assertions"><a class="anchor" href="#_disabling_snapshot_assertions"></a><a class="link" href="#_disabling_snapshot_assertions">3.6. Disabling Snapshot Assertions</a></h3>
<div class="paragraph">
<p>The framework offers a possibility to <em>gracefully</em> disable a snapshot assertion. This means that the assertion will
still be registered with the framework in order to not confuse the consecutive numbering. It won&#8217;t do any comparison
though and thus won&#8217;t cause a test failure.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
You can not simply comment the assertion or remove the terminal DSL operation. Commenting the assertion
would confuse the numbering and removing the terminal operation is not allowed and will lead to an exception.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If a test case contains only <em>disabled</em> and <em>successfully</em> executed snapshot assertions, the framework will
properly report the test case as <em>skipped</em> to the test framework by throwing the appropriate assumption failure.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Advise the framework to always persist latest test results without header information.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="type">void</span> testWithDisabledAssertions(Snapshot snapshot) <span class="directive">throws</span> <span class="exception">Exception</span> {
    <span class="directive">final</span> Person person1 = person();
    <span class="directive">final</span> Person person2 = person();
    <span class="directive">final</span> Person person3 = person();
    snapshot.assertThat(person1).asText().disabled(); <i class="conum" data-value="1"></i><b>(1)</b>
    snapshot.assertThat(person2).asText().disabledBecause(<span class="string"><span class="delimiter">&quot;</span><span class="content">See bug reference TBD-1337</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="2"></i><b>(2)</b>
    snapshot.assertThat(person3).asText().matchesSnapshotText(); <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Simply disable the assertion</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Disable the assertion and provide an informative reason why it is disabled</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Execute another assertion which will correctly get the number <code>3</code> assigned</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_parameterized_tests"><a class="anchor" href="#_parameterized_tests"></a><a class="link" href="#_parameterized_tests">3.7. Parameterized Tests</a></h3>
<div class="paragraph">
<p>Snapshot tests work well together with JUnit5&#8217;s <code>@ParameterizedTest</code> but only if you take care of proper snapshot naming
yourself like in this snippet:</p>
</div>
<div class="listingblock">
<div class="title">Advise the framework to always persist latest test results without header information.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ParameterizedTest</span>
<span class="annotation">@ValueSource</span>(strings = { <span class="string"><span class="delimiter">&quot;</span><span class="content">string1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">string2</span><span class="delimiter">&quot;</span></span> })
<span class="type">void</span> testParameterized(<span class="predefined-type">String</span> param, Snapshot snapshot) {

    snapshot.namedAccordingTo(SnapshotNaming.withParameters(param))
            .assertThat(param)
            .asText()
            .matchesSnapshotText();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will make each parameter&#8217;s value part of the generated snapshot&#8217;s file name.</p>
</div>
<div class="paragraph">
<p>Otherwise, when using the default naming strategy, the framework would choose the same snapshot name for every
parameterized execution.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The behavior of choosing the same snapshot name for each parameter could actually be desirable if you want to
test that your code produces the exact same result for different parameters.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Check out the <code>SnapshotNaming</code> interface for more options regarding snapshot naming.</p>
</div>
</div>
<div class="sect2">
<h3 id="_soft_assertions"><a class="anchor" href="#_soft_assertions"></a><a class="link" href="#_soft_assertions">3.8. Soft Assertions</a></h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Soft assertions are a deprecated feature and will be removed with version <code>2.0.0</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As learned in the previous section, you can easily have multiple snapshot assertions within the same test method.
Naturally, if the first assertion fails, all subsequent assertions will not be executed, thus potentially hiding further
problems.</p>
</div>
<div class="paragraph">
<p>However, there is an option to enable <em>soft assertions</em>. That will advice the framework to collect all assertion
failures and report them in a single stack trace at the end.</p>
</div>
<div class="listingblock">
<div class="title">Enable soft assertions</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EnableSnapshotTests</span>(softAssertions = <span class="predefined-constant">true</span>)
<span class="type">class</span> <span class="class">SomeTest</span> {
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<em>Soft assertions</em> are currently only supported on a per-class basis.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_advanced_topics"><a class="anchor" href="#_advanced_topics"></a><a class="link" href="#_advanced_topics">4. Advanced topics</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_dealing_with_random_values_in_test_results"><a class="anchor" href="#_dealing_with_random_values_in_test_results"></a><a class="link" href="#_dealing_with_random_values_in_test_results">4.1. Dealing With Random Values in Test Results</a></h3>
<div class="paragraph">
<p>A common source of problems are random values within the snapshot data such as dates or generated ids. Generally, you
should design your code up front so that such randomness can easily be mocked away. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Instead of using <code>LocalDateTime.now()</code> make your code use a shared <code>Clock</code> instance that is replacable in tests and
use <code>LocalDateTime.now(clock)</code></p>
</li>
<li>
<p>More generally put: If your code uses random values in any place, consider to use a strategy interface instead which
can be replaced with a deterministic mock during testing.</p>
</li>
<li>
<p>As a last resort, you can implement some normalization. Either post-process your actual test result before taking the
snapshot or implement a <code>SnapshotSerializer</code> which does the normalization. You could also implement
<code>StructralAssertions</code> in a way that it ignores such random values during comparison.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>New</strong>
The latest version of this library comes with a very simple (and experimental) abstraction for customizing the
structural comparison. You can use json-path resp. xpath expressions to customize the comparison on a per-node basis.</p>
</div>
<div class="paragraph">
<p>XML example:</p>
</div>
<div class="listingblock">
<div class="title">Define custom comparison rules for XML or HTML snapshots based on xpath expressions.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">snapshot.assertThat(someObjext)
        .as(XmlSnapshot.xml()
                .withComparisonRules(rules -&gt; rules
                        .pathAt(<span class="string"><span class="delimiter">&quot;</span><span class="content">/person/address/city/text()</span><span class="delimiter">&quot;</span></span>).ignore()
                        .pathAt(<span class="string"><span class="delimiter">&quot;</span><span class="content">/person/date/text()</span><span class="delimiter">&quot;</span></span>).mustMatch(<span class="predefined-type">Pattern</span>.compile(<span class="string"><span class="delimiter">&quot;</span><span class="char">\\</span><span class="content">d{4}-</span><span class="char">\\</span><span class="content">d{2}-</span><span class="char">\\</span><span class="content">d{2}</span><span class="delimiter">&quot;</span></span>))))
        .matchesSnapshotStructure()</code></pre>
</div>
</div>
<div class="paragraph">
<p>JSON example:</p>
</div>
<div class="listingblock">
<div class="title">Define custom comparison rules for JSON snapshots based on json-path expressions.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">snapshot.assertThat(someObjext)
        .as(JsonSnapshot.json()
                .withComparisonRules(rules -&gt; rules
                        .pathAt(<span class="string"><span class="delimiter">&quot;</span><span class="content">address.city</span><span class="delimiter">&quot;</span></span>).ignore()
                        .pathAt(<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>).mustMatch(<span class="predefined-type">Pattern</span>.compile(<span class="string"><span class="delimiter">&quot;</span><span class="char">\\</span><span class="content">d{4}-</span><span class="char">\\</span><span class="content">d{2}-</span><span class="char">\\</span><span class="content">d{2}</span><span class="delimiter">&quot;</span></span>))))
        .matchesSnapshotStructure();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_driving_snapshot_tests_from_files"><a class="anchor" href="#_driving_snapshot_tests_from_files"></a><a class="link" href="#_driving_snapshot_tests_from_files">4.2. Driving Snapshot Tests From Files</a></h3>
<div class="paragraph">
<p>Using stored files as input for your snapshot tests is a great way to quickly create new test cases. You can find
details in this <a href="https://simon.taddiken.net/directory-driven-tests/">blog post</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.8.0<br>
Last updated 2023-01-18 13:13:23 +0100
</div>
</div>
</body>
</html>