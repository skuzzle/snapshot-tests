plugins {
    id("io.github.gradle-nexus.publish-plugin") version "1.1.0"
    id("net.researchgate.release") version "3.0.2"
    id ("com.github.breadmoirai.github-release") version "2.4.1"
}

afterReleaseBuild.dependsOn "publishToSonatype", "commitFilesToGit"

release {
    pushReleaseVersionBranch = 'master'
    tagTemplate = 'v$version'
    git {
        requireBranch.set("dev")
    }
}

tasks.register("commitFilesToGit") {
    dependsOn(":snapshot-tests-documentation:deployDocsToRepositoryRoot", ":readme:generateReadmeAndReleaseNotes")
    group "release"
    description "Commit changed/generated files during release"
    "git add README.md RELEASE_NOTES.md".execute()
    "git add --force docs/*".execute()
    "git commit -m \"Update README and RELEASE_NOTES\"".execute()
}


githubRelease {
    token provider({ project.findProperty("gh_token") })
    owner githubUser
    repo githubRepo
    body provider({
        file("RELEASE_NOTES.md").getText()
    })
}


nexusPublishing {
    repositories {
        sonatype {
            username = findProperty("sonatype_USR")
            password = findProperty("sonatype_PSW")
        }
    }
}

ext {
    bomProjects = Set.of(
            projects.snapshotTestsCore,
            projects.snapshotTestsJunit4,
            projects.snapshotTestsJunit5,
            projects.snapshotTestsHtml,
            projects.snapshotTestsJackson,
            projects.snapshotTestsJaxb,
            projects.snapshotTestsJaxbJakarta,
            projects.snapshotTestsNormalize,
            projects.snapshotTestsDirectoryParams
    );

    allCodeProjects = Set.of(
            projects.snapshotTestsCommon,
            projects.snapshotTestsDocumentation,
    )
}

